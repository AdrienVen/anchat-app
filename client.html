<!DOCTYPE html>
<html lang="en">
<head>
    <title>AnChat - Login</title>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
<script type="text/javascript">
url = ('http://' + document.domain + ':' + location.port);
socket = io.connect(url);
variables = {};
function join(){
    let group = document.getElementById("groupName").value;
	let username = document.getElementById("input2").value;
	variables["group"] = group;
	variables["username"] = username;
    socket.emit( "join", {"group" : group, "username": username});
}

socket.on("joinStatus", function(data){
	if (data === "ok"){
		chatLayout();
	} else {
		document.getElementById("title").innerHTML = "Something's wrong...";
		document.getElementById("subtitle").innerHTML = "The username you have chosen if already taken, please select another.";
		document.getElementById("input2").value = "";
	}
});

function chatLayout(){
	document.getElementById("title").innerHTML = "Welcome to " + variables["group"]+' '+variables["username"]+ '!';
	document.getElementById("subtitle").innerHTML = "You may start chatting with the members of the group.";
	document.getElementById("groupName").placeholder = "Send to " + variables["group"];
	document.getElementById("input2").remove();
	document.getElementById("button1").value = "Send Message";
	document.getElementById("button1").onclick = send;	
}

//send_msg - send messages from the user
function send(){
	document.getElementById("groupName").value = "";
	socket.emit("recv",{
						"group":	variables["group"],
						"user":		variables["username"],
						"message": 	document.getElementById("groupName").value
						})
	let node = document.createElement("P");
	node.innerHTML = document.getElementById("groupName").value;
	node.style.color = "blue";
	document.getElementById("messages").appendChild(node);
}

//Recv_msg - gets messages coming in
socket.on("recv", function(data){
			let node = document.createElement("P");
			node.innerHTML = data["user"]+':\t'+data["message"];
			node.style.color = "red";
			document.getElementById("messages").appendChild(node);
		})
</script>
<body>

    <h1 class="h1_1" id="title">Welcome to the chat!</h1>
    <p class= "p_1" id ="subtitle">Please choose a group to join or type the name of the group you want to create.</p>
	<div id="messages"></div>
    <input id="groupName" placeholder="group name"></input>
	<input id="input2" placeholder="username"></input>
    <input id="button1" type="submit" value="Join" onclick="join()"></input>

</body>
</html>
<!--EXITING (client)
Leave_group - user leaves the group and notifies the server
server_down - server shuts down and ends the group for everyone by telling all the clients -->